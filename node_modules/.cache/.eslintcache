[{"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\index.js":"1","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\page.js":"2","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\FacebookPlugin.js":"3","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\BiciTours.js":"4","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\Header.js":"5","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\SelloCalidad.js":"6","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\VehiculeTours.js":"7","C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\Maps.js":"8"},{"size":211,"mtime":1689953971000,"results":"9","hashOfConfig":"10"},{"size":9661,"mtime":1691381626721,"results":"11","hashOfConfig":"10"},{"size":816,"mtime":1691347544128,"results":"12","hashOfConfig":"10"},{"size":1296,"mtime":1691382023695,"results":"13","hashOfConfig":"10"},{"size":327,"mtime":1689953971000,"results":"14","hashOfConfig":"10"},{"size":755,"mtime":1689953971000,"results":"15","hashOfConfig":"10"},{"size":1084,"mtime":1689953971000,"results":"16","hashOfConfig":"10"},{"size":588,"mtime":1689953971000,"results":"17","hashOfConfig":"10"},{"filePath":"18","messages":"19","suppressedMessages":"20","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"1hno152",{"filePath":"21","messages":"22","suppressedMessages":"23","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"24","usedDeprecatedRules":"25"},{"filePath":"26","messages":"27","suppressedMessages":"28","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"29","messages":"30","suppressedMessages":"31","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"32","messages":"33","suppressedMessages":"34","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"35","messages":"36","suppressedMessages":"37","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"38","messages":"39","suppressedMessages":"40","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"41","messages":"42","suppressedMessages":"43","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\index.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\page.js",["44","45"],[],"// pages/index.js\n\"use client\"\n\n/*\n________________________________________________________________________________________________________________________________\n\nnunca olvidar el \"use client\" si no da error \n________________________________________________________________________________________________________________________________\n\n*/\n// pages/index.js\nimport React, { useState, useEffect } from 'react';\nimport 'react-calendar/dist/Calendar.css';\nimport Calendar from 'react-calendar';\nimport axios from 'axios';\n\nimport './globals.css';\nimport Header from './Header';\nimport BiciTours from './BiciTours';\nimport VehiculeTours from './VehiculeTours';\nimport FacebookPlugin from './FacebookPlugin';\nimport Maps from './Maps';\nimport SelloCalidad from './SelloCalidad';\n\nfunction DatePicker() {\n  const [selectedDate, setSelectedDate] = useState(null);\n  const [cantidad_personas, setCantidadPersonas] = useState('');\n  const [servicioId, setServicioId] = useState('');\n  const [servicios, setServicios] = useState([]);\n  const [servicioSeleccionado, setServicioSeleccionado] = useState('');\n  const [cuposDisponibles, setCuposDisponibles] = useState(0);\n  const [blockedDates, setBlockedDates] = useState([]);\n  const [showBlockedDates, setShowBlockedDates] = useState(false);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [reservasEnFecha, setReservasEnFecha] = useState([]); \n  const [fetchResult, setFetchResult] = useState('');\n  const [correo, setCorreo] = useState('');\n  const images = [\n    '/imagenes/pisco.jpg',\n    '/imagenes/tourbici.jpg',\n    '/imagenes/bici2.jpg',\n  ];\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentImageIndex((prevIndex) => (prevIndex + 1) % images.length);\n    }, 3000); // Cambiar la imagen cada 3 segundos\n\n    return () => clearInterval(interval); // Limpiar el intervalo al desmontar el componente\n  }, []);\n\n  useEffect(() => {\n    axios\n      .get('https://backedpago.fly.dev/api/servicios')\n      .then((response) => {\n        setServicios(response.data);\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  }, []);\n\n  useEffect(() => {\n    fetchBlockedDates();\n  }, []);\n\n  const fetchBlockedDates = async () => {\n    try {\n      const res = await axios.get('https://backedpago.fly.dev/api/blocked-dates');\n      setBlockedDates(res.data);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const handleDateChange = (date) => {\n    setSelectedDate(date);\n    setReservasEnFecha([]); // Agregado aquí para reiniciar las reservas en fecha\n    fetchReservasEnFecha(date);\n  };\n\n  const fetchReservasEnFecha = (date) => {\n    const formattedDate = formatDate(date);\n    axios\n      .get(`https://backedpago.fly.dev/api/reservas/${formattedDate}`)\n      .then((response) => {\n        setReservasEnFecha(response.data);\n\n        if (response.data.length > 0) {\n          const reservaServicioId = response.data[0].servicio_id;\n          const servicio = servicios.find((servicio) => servicio.id === reservaServicioId);\n          const nombreServicio = servicio?.nombre;\n          const totalCupos = servicio?.cupos_maximos - response.data.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0);\n\n          setServicioSeleccionado(nombreServicio);\n          setCuposDisponibles(totalCupos);\n        } else {\n          setServicioSeleccionado('');\n          setCuposDisponibles(0);\n        }\n      })\n      .catch((error) => {\n        console.error(error);\n        setReservasEnFecha([]);\n        setServicioSeleccionado('');\n        setCuposDisponibles(0);\n      });\n  };\n\n  const formatDate = (date) => {\n    if (date) {\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    }\n    return '';\n  };\n\n  const saveDateToDatabase = () => {\n    const formattedDate = formatDate(selectedDate);\n  \n    if (formattedDate && validateServicioId() && validateCantidadPersonas()) {\n      const selectedServicio = servicios.find((servicio) => servicio.id === parseInt(servicioId));\n      \n      if (selectedServicio) {\n        const descripcion = `${selectedServicio.nombre} para ${cantidad_personas} persona/s en la fecha ${selectedDate.toLocaleDateString()}`;\n        const valorServicioSeleccionado = selectedServicio ? selectedServicio.valor_servicio : 0;\n  \n        const data = {\n          servicio_id: parseInt(servicioId),\n          fecha_reserva: formattedDate,\n          correo: correo,\n          cantidad_personas: parseInt(cantidad_personas),\n          valor_pagado: parseInt(valorServicioSeleccionado * cantidad_personas),\n          description: descripcion\n        };\n    \n        axios\n          .post('https://backedpago.fly.dev/reservas', data)\n          .then((response) => {\n            console.log(response.data);\n            setFetchResult(response.data.message);\n    \n            window.location.href = response.data.redirectUrl;\n          })\n          .catch((error) => {\n            console.error(error);\n          });\n      }\n    }\n  };\n  \n    \n  const maxCupos = servicios.find((servicio) => servicio.id === parseInt(servicioId))?.cupos_maximos || 0;\n  const toggleBlockedDates = () => {\n    setShowBlockedDates(!showBlockedDates);\n  };\n\n  const validateServicioId = () => {\n    const parsedServicioId = parseInt(servicioId);\n    return !isNaN(parsedServicioId) && parsedServicioId >= 1 && parsedServicioId <= 7;\n  };\n\n  const validateCantidadPersonas = () => {\n    const parsedCantidadPersonas = parseInt(cantidad_personas);\n    const selectedServicio = servicios.find((servicio) => servicio.id === parseInt(servicioId));\n  \n    const cuposRestantes = maxCupos - reservasEnFecha.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0);\n  \n    return (\n      !isNaN(parsedCantidadPersonas) &&\n      parsedCantidadPersonas >= 1 &&\n      selectedServicio &&\n      parsedCantidadPersonas <= cuposRestantes\n    );\n  };\n  \n \n\n  return (\n    <div className=\"container\">\n      <Header />\n      <div class=\"image-gallery\">\n        <img src={images[currentImageIndex]} alt={`Imagen ${currentImageIndex + 1}`} />\n        <div class=\"gallery-title\">Nuestros Servicios</div>\n      </div>\n\n      <div className=\"Tour\" style={{ marginTop: '-70px' }}>\n        <BiciTours />\n        <VehiculeTours />\n      </div>\n      <div className=\"form-container\">\n        <h1>Reserva tu tour</h1>\n        <button onClick={toggleBlockedDates}>\n          {showBlockedDates ? 'Ocultar' : 'Mostrar'} Fechas no disponibles\n        </button>\n        {showBlockedDates && (\n          <ul>\n            {blockedDates.map((date, index) => (\n              <li key={index} className=\"blocked-date\">\n                {date.fecha_reserva}\n              </li>\n            ))}\n          </ul>\n        )}\n        <Calendar\n          onChange={handleDateChange}\n          value={selectedDate}\n          minDate={new Date()} // Establece la fecha mínima como la fecha actual\n        />\n        <p>Servicios</p>\n        <select\n          value={servicioId}\n          onChange={(e) => setServicioId(e.target.value)}\n          placeholder=\"Selecciona un servicio\"\n        >\n        <option value=\"\">Selecciona un servicio</option>\n        {servicios.map((servicio) => (\n          (servicioSeleccionado && reservasEnFecha.some(reserva => reserva.servicio_id === servicio.id)) ||\n          (!servicioSeleccionado || !reservasEnFecha.length) ? (\n            <option key={servicio.id} value={servicio.id}>\n              {servicio.nombre}\n            </option>\n          ) : null\n        ))}\n      </select>\n\n\n        <input\n          type=\"number\"\n          value={cantidad_personas}\n          onChange={(e) => setCantidadPersonas(e.target.value)}\n          placeholder={`Cantidad de personas (1-${maxCupos - reservasEnFecha.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0)})`}\n          max={maxCupos - reservasEnFecha.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0)}\n          min={servicioSeleccionado ? 1 : 0}\n          style={{ width: '100%', padding: '4px' }}\n/>\n\n<input\n          type=\"email\"\n          value={correo}\n          onChange={(e) => setCorreo(e.target.value)}\n          placeholder=\"Correo electrónico\"\n          />\n        {!validateCantidadPersonas() && (\n          <p className=\"error-message\">\n            Por favor, ingresa una cantidad de personas válida (1 a {maxCupos - reservasEnFecha.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0)}).\n          </p>\n        )}\n\n        {servicioSeleccionado && (\n          <div>\n            <p>\n              Hay reservas en la fecha seleccionada del servicio {servicioSeleccionado}.\n            </p>\n            <p>\n              Cupos  {cuposDisponibles}\n            </p>\n            <p>\n              Cantidad de personas en reservas: {reservasEnFecha.reduce((total, reserva) => total + parseInt(reserva.total_personas), 0)}\n            </p>\n          \n          </div>\n        )}\n        {!servicioSeleccionado && <p>No hay reservas en la fecha seleccionada.</p>}\n       \n\n        <button onClick={saveDateToDatabase}>Pagar</button>\n      </div>\n\n      <div className=\"FacebookPlugin\" style={{ position: 'absolute', bottom: '-1415px', right: '140px' }}>\n        <FacebookPlugin />\n      </div>\n\n      <div className=\"Maps\" style={{ position: 'absolute', bottom: '-1650px', right: '500px' }}>\n        <Maps />\n      </div>\n\n      <div className=\"Sello\">\n        <SelloCalidad />\n      </div>\n    </div>\n  );\n}\n\nexport default DatePicker;\n",[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\FacebookPlugin.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\BiciTours.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\Header.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\SelloCalidad.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\VehiculeTours.js",[],[],"C:\\Users\\Francisco\\Downloads\\reservaslab-main\\src\\Maps.js",[],[],{"ruleId":"46","severity":1,"message":"47","line":36,"column":10,"nodeType":"48","messageId":"49","endLine":36,"endColumn":21},{"ruleId":"50","severity":1,"message":"51","line":50,"column":6,"nodeType":"52","endLine":50,"endColumn":8,"suggestions":"53"},"no-unused-vars","'fetchResult' is assigned a value but never used.","Identifier","unusedVar","react-hooks/exhaustive-deps","React Hook useEffect has a missing dependency: 'images.length'. Either include it or remove the dependency array.","ArrayExpression",["54"],{"desc":"55","fix":"56"},"Update the dependencies array to be: [images.length]",{"range":"57","text":"58"},[1908,1910],"[images.length]"]